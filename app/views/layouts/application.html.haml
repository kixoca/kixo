!!!
%html
  %head
    %title= @page_title or t("site.title")
    = tag :meta, :name => "viewport",   :content => "width=device-width, initial-scale=1.0"
    = tag :meta, :name => "stripe-key", :content => ENV['STRIPE_PUBLIC_KEY']
    = google_webfonts_link_tag :bree_serif => 400, :open_sans => ["300italic", "400italic", "600italic", "700italic", "800italic", 400, 300, 600, 700, 800]
    = stylesheet_link_tag "application", :media => "all"
    = javascript_include_tag "https://js.stripe.com/v1/"
    = javascript_include_tag "//maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"
    = javascript_include_tag "application"
    = render "shared/mixpanel"
    %link{:rel => "canonical", :href => @canonical_url || url_for}
    = csrf_meta_tags
    %link{:rel => "shortcut icon", :href => "/assets/favicon.png"}
  %body
    %header#header
      %section#language-select
        .container
          .row
            .eight.columns.centered.mobile-twelve
              %ul.block-grid.four-up
                - @all_locales.each do |loc|
                  %li= link_to loc.name, url_for(:locale => loc.code)
      %section#head
        .container
          .row
            .four.columns.mobile-text-center
              .row
                .six.columns
                  #brand
                    = link_to "/#{I18n.locale}" do
                      %img#logo{:src => "/assets/logo.png", :width => "140", :height => "45", :alt => t("layout.logo.alt")}
                .six.columns
                  #language
                    %a.toggle.slide{:href => "#language-select"}
                      = Locale.find_by_code(locale).name
                      %i.icon-chevron-down
            .eight.columns
              %ul#account
                - if user_signed_in?
                  %li#notifications
                    = link_to notifications_path do
                      %i.icon-bell
                      - if current_user.notifications.unseen.count > 0
                        .count= current_user.notifications.unseen.count
                  %li#messages
                    = link_to conversations_path do
                      %i.icon-envelope
                      - if current_user.messages.unread.count > 0
                        .count= current_user.messages.unread.count
                  %li#settings
                    = link_to edit_user_registration_path do
                      %i.icon-cog
                  %li#signout
                    = link_to destroy_user_session_path, :method => :delete do
                      %i.icon-signout
                  %li#profile
                    - if current_user.is_a_professional?
                      = link_to professional_path(current_user) do
                        = image_tag current_user.headshot.url(:mini), :class => "headshot"
                        = current_user.name.blank? ? current_user.email : current_user.name
                    - else
                      = current_user.name.blank? ? current_user.email : current_user.name
                - else
                  %li#login
                    %a.button.secondary.small{:href => "#", :data => {"reveal-id" => "new_session"}}
                      = t("users.sessions.new.label")
                  %li#signup
                    %a.button.secondary.small{:href => new_user_registration_path}
                      = t("users.registrations.new.label")
      %section#actions
        #actions-tabs
          .container
            .row
              .twelve.columns
                %dl.tabs.two-up
                  %dd{:class => @current_action_tab == "ask" ? "active" : ""}
                    %a{:href => "#ask"}
                      .hide-for-small
                        %i.icon-question-sign
                        %span
                          = t("layout.actions.ask.tab_name")
                      .show-for-small
                        %i.icon-question-sign
                      .arrow
                  %dd{:class => @current_action_tab == "search" ? "active" : ""}
                    %a{:href => "#search"}
                      .hide-for-small
                        %i.icon-search
                        %span
                          = t("layout.actions.search.tab_name")
                      .show-for-small
                        %i.icon-search
                      .arrow
        #actions-tabs-content
          %ul.tabs-content
            %li#askTab{:class => @current_action_tab == "ask" ? "active" : ""}
              .row
                .three.columns.text-center
                  %img{:src => "/assets/banner_ask_char.png", :width => 250, :height => 160}
                .nine.columns
                  .container
                    %hgroup
                      %h2
                        = t("layout.actions.ask.title")
                      %h3.subheader
                        = t("layout.actions.ask.subtitle")
                    = form_tag new_question_path, :method => "get" do
                      .row
                        .ten.columns
                          = text_field_tag "question[title]", nil, :placeholder => t("layout.actions.ask.placeholder"), :class => "oversize"
                        .two.columns
                          = submit_tag t("layout.actions.ask.button"), :class => "button expand postfix"
            %li#searchTab{:class => @current_action_tab == "search" ? "active" : ""}
              .row
                .three.columns.text-center
                  %img{:src => "/assets/banner_search_char.png", :width => 250, :height => 160}
                .nine.columns
                  .container
                    %hgroup
                      %h2
                        = t("layout.actions.search.title")
                      %h3.subheader
                        = t("layout.actions.search.subtitle")
                    = form_tag search_professionals_path, :method => "get" do
                      .row
                        .six.columns
                          = text_field_tag "what", @what, :placeholder => t("layout.actions.search.placeholders.what"), :class => "oversize autocomplete", :data => {:source => "/#{I18n.locale}/whats.json"}
                        .four.columns
                          = text_field_tag "where", @where, :placeholder => t("layout.actions.search.placeholders.where"), :class => "oversize autocomplete", :data => {:source => "/#{I18n.locale}/wheres.json"}
                        .two.columns
                          = submit_tag t("layout.actions.search.button"), :class => "button expand postfix"
    %section#content
      .container
        = yield
    %section#flashes
      .container
        = render "shared/flashes"
    %section#modals
      = render "users/sessions/modals/new"
      = render "conversations/shared/modals/new"
    %footer#footer
      .container
        .row
          .four.columns
            #about-kixo
              %h5
                = link_to "/#{I18n.locale}" do
                  = image_tag "/assets/logo_grayscale.png", :width => 100, :height => 32, :alt => t("layout.logo.alt")
              %p#kixo-description
                =t("site.about.description")
            #social-media
              %ul.inline
                %li
                  = link_to "http://twitter.com/kixo", :target => "_blank" do
                    %i.icon-twitter-sign
                %li
                  = link_to "http://fb.com/kixo.ca", :target => "_blank" do
                    %i.icon-facebook-sign
                %li
                  = link_to "http://www.linkedin.com/company/2829266", :target => "_blank" do
                    %i.icon-linkedin-sign
                %li
                  = link_to "http://www.google.com", :target => "_blank" do
                    %i.icon-google-plus-sign
                %li
                  = link_to "http://www.pinterest.com", :target => "_blank" do
                    %i.icon-pinterest-sign
          .two.columns
            #browse_by_category
              %h5
                = t("categories.index.title")
              %ul.categories
                - @top_categories.each do |category|
                  %li= link_to category.name, category_path(category)
                - if @top_categories.count < @all_categories.count
                  %li= link_to t("categories.index.view_all"), categories_path
          .two.columns
            #browse_by_topic
              %h5
                = t("topics.index.title")
              %ul.topics
                - @top_topics.each do |topic|
                  %li= link_to topic.name, category_topic_path(topic.category, topic)
          .two.columns
            #browse_by_profession
              %h5
                = t("professions.index.title")
              %ul.topics
                - @top_professions.each do |profession|
                  %li= link_to profession.name, category_profession_path(profession.category, profession)
          .two.columns
            #browse_by_locality
              %h5
                = t("localities.index.title")
              %ul.localities
                - @top_localities.each do |locality|
                  %li= link_to locality.name, country_region_locality_path(locality.region.country, locality.region, locality)
